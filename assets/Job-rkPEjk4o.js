import{r as s,j as e,D as Re,d as qe,au as $e,av as He,e as et,a1 as mt,a2 as bt,aw as ke,ah as xt,as as tt,a4 as ot,ax as ht,ay as pt,az as jt,E as yt,T as Ge,F as _e,J as Ct,K as gt,M as vt,P as Xe,C as Y,aa as V,aA as kt,a6 as st,aB as Ke,Q as wt,V as Nt,X as St,Y as Tt,aC as Pt,aD as Jt,aE as Dt,x as Et,aF as It}from"./vendor-LjbCKWXj.js";import{L as rt}from"./Loading-Cd5r56ie.js";import{s as at}from"./successAnimation-C1ByJTMN.js";import{u as we,a as Ne,A as R}from"./index-DLufcNUo.js";import{P as Bt,u as Lt,J as At}from"./Vacancy-s-gXaWMi.js";import{D as me,M as Qe}from"./monetaryUtil-Ccsb3nQ9.js";import{S as Ye}from"./images-Bf77nNy9.js";import{u as Ft}from"./useConfirmation-DIkYVyS7.js";function nt({...t}){const{authToken:d}=we(),{dispatch:L}=Ne(),[i,q]=s.useState(1),[b,J]=s.useState(!1),[A,$]=s.useState(!1),[Z,k]=s.useState(!0),[D,g]=s.useState(t.profileType==="contractor"),[x,w]=s.useState(!1),[u,N]=s.useState(!1),[c,E]=s.useState(!1),[f,G]=s.useState(!1),[m,H]=s.useState(!1),[S,_]=s.useState(""),[y,F]=s.useState(0),ee=async()=>{if(N(!0),E(!0),y<=0){N(!1),E(!1),L({type:"SHOW_ALERT",payload:{type:"error",text:"O feedback precisa ter uma avaliação mínima (ao menos 1 estrela)"}});return}if(d&&t.job){let C="",I={};t.profileType==="contractor"?(C="/providers/jobs/feedbacks",I={providerAttendedJob:m,comment:S,star:y,sender:t.job.contractor.id,receiver:t.job.provider.id,jobId:t.job.id,createdAt:new Date}):t.profileType==="provider"&&(C="/contractors/jobs/feedbacks",I={comment:S,star:y,sender:t.job.provider.id,receiver:t.job.contractor.id,jobId:t.job.id,createdAt:new Date});const O=await R.request({origin:"Web",method:"POST",url:C,data:I,authToken:d});if(O.success&&O.data){const oe=O.data;N(!1),E(!1),G(!0),setTimeout(()=>{t.callbackSuccess(oe)},6e3)}else E(!1),N(!1),t.callbackError()}},W=()=>{t.profileType==="contractor"?i===2?ee():q(i+1):t.profileType==="provider"&&i===1&&ee()},X=()=>{i>1&&q(i-1)},re=()=>{if(t.profileType==="contractor")switch(i){case 1:return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("span",{className:"text-tertiaryColor",children:"Freelancer compareceu ao serviço?"}),e.jsxs("div",{className:"flex flex-col items-center justify-start w-full mt-16",children:[e.jsx("button",{className:"flex items-center justify-center w-full h-12 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-successColor shadow-successColor/40 text-successColor hover:text-tertiaryColor rounded-xl hover:bg-successColor",onClick:()=>{H(!0),W()},children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(ke,{weight:"bold",className:"w-6 h-6 mr-2"}),e.jsx("span",{children:"Sim"})]})}),e.jsx("button",{className:"flex items-center justify-center w-full h-12 mt-5 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-errorColor shadow-errorColor/40 text-errorColor hover:text-tertiaryColor rounded-xl hover:bg-errorColor",onClick:()=>{H(!1),W()},children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(xt,{weight:"bold",className:"w-6 h-6 mr-2"}),e.jsx("span",{children:"Não"})]})})]})]});case 2:return f?e.jsxs(e.Fragment,{children:[" ",te()," "]}):M()}else if(t.profileType==="provider")switch(i){case 1:return f?e.jsxs(e.Fragment,{children:[" ",te()," "]}):M()}},M=()=>e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx("div",{className:"flex justify-start w-full mb-1",children:e.jsx("span",{className:"text-tertiaryColor text-start",children:"Avaliação*"})}),e.jsx(ot,{size:"large",value:y,onChange:(C,I)=>{C&&I!==null&&I>0&&F(I)},disabled:u}),e.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:e.jsx("span",{className:"text-tertiaryColor text-start",children:"Comentário*"})}),e.jsx("textarea",{className:"block w-full h-48 px-3 py-2 bg-opacity-0 border rounded-md shadow-sm resize-none text-tertiaryColor bg-secondaryColor border-tertiaryColor placeholder-tertiaryColor/50 focus:outline-none focus:border-primaryColor focus:ring-primaryColor focus:ring-1 invalid:border-errorColor invalid:text-errorColor focus:invalid:border-errorColor focus:invalid:ring-errorColor",placeholder:"Digite sua avaliação",maxLength:500,disabled:u,onChange:C=>_(C.target.value),value:S}),e.jsx("span",{className:"self-end text-sm text-tertiaryColor",children:`${S.length} / 500`})]}),te=()=>e.jsxs("div",{className:"flex flex-col justify-center w-full h-full",children:[e.jsx("span",{className:"w-full text-xl font-semibold text-center text-successColor",children:"Feedback enviado com sucesso"}),e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(tt,{className:"w-80 h-80",animationData:at,initialSegment:[0,120],loop:!1})})]}),z=()=>{q(1),J(!1),$(!1),k(t.profileType!=="contractor"),g(t.profileType!=="contractor"),w(!1),N(!1),E(!1),G(!1),H(!1),_(""),F(0)};return s.useEffect(()=>{if(t.profileType==="contractor")switch(i){case 1:k(!1),g(!1),w(!0);break;case 2:k(!0),g(!0),y>0&&S.length>0?w(!1):w(!0);break}else t.profileType==="provider"&&i===1&&(y>0&&S.length>0?w(!1):w(!0))},[i,y,S]),s.useEffect(()=>{z()},[t.open]),e.jsx(e.Fragment,{children:e.jsxs(Re,{onClose:t.onClose,open:t.open,maxWidth:"xl",children:[e.jsx(qe,{className:"w-full text-xl font-bold text-center text-tertiaryColor bg-gradient-to-b from-primaryColor to-quaternaryColor",children:`Avaliar ${t.profileType==="contractor"?"Freelancer":"Contratante"}`}),e.jsx($e,{edge:"end",onClick:t.onClose,"aria-label":"close",sx:{position:"absolute",top:"12px",right:"20px"},disabled:u,children:e.jsx(He,{})}),e.jsx(et,{className:"bg-[#222]",children:e.jsxs("div",{className:"flex flex-col items-center justify-around tablet:w-[22rem] mobile:w-[16rem] h-[26rem]",children:[e.jsx("div",{className:"flex w-full h-full",children:re()}),!f&&e.jsxs("div",{className:"flex items-start justify-between w-full h-20 mx-auto mobile:pb-4",children:[Z&&e.jsxs("button",{type:"button",className:"flex flex-col items-center w-16",onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),onClick:X,disabled:c||u,children:[e.jsx(mt,{size:42,className:`transition-transform duration-500 
                                                ${u?"text-tertiaryColor/50 scale-100":b?"scale-110 text-primaryColor":"scale-100 text-tertiaryColor"}
                                            `}),e.jsx("span",{className:`mt-3 transition-transform duration-1000 
                                                ${u?"text-tertiaryColor/50":b?"text-primaryColor":"text-tertiaryColor"}
                                            `,children:"Voltar"})]}),D&&e.jsxs("button",{type:"button",className:"flex flex-col items-center",onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),onClick:W,disabled:x||u,children:[e.jsx(bt,{size:42,className:`transition-transform duration-500 
                                                ${x||u?"scale-110 text-tertiaryColor/50":`${A?"scale-110 text-primaryColor":"scale-100 text-tertiaryColor"}`}
                                            `}),e.jsx("span",{className:`mt-3 transition-transform duration-1000
                                                ${x||u?"text-tertiaryColor/50":`${A?"text-primaryColor":"text-tertiaryColor"}`}
                                            `,children:t.profileType==="contractor"?i===2?"Finalizar":"Próximo":i===1?"Finalizar":"Próximo"})]})]}),c&&e.jsx(rt,{})]})})]})})}function Ze({...t}){const{authToken:d}=we(),{dispatch:L}=Ne(),i=s.useRef(null),[q,b]=s.useState(null),[J,A]=s.useState(!1),[$,Z]=s.useState(!1),[k,D]=s.useState("prompt"),[g,x]=s.useState(null),w={facingMode:{ideal:"user"}},u=()=>{if(!J)if(i.current){const m=i.current.getScreenshot();m?(console.log(q),b(m),N(m)):L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao realizar a captura"}})}else L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao verificar a câmera do dispositivo"}})},N=async m=>{if(A(!0),d&&t.job&&m){const H=t.type==="in"?"/providers/jobs/check-ins":"/providers/jobs/check-outs",_={image:jt.Buffer.from(m.split(",")[1],"base64"),latitude:(g==null?void 0:g.latitude)||0,longitude:(g==null?void 0:g.longitude)||0,providerId:t.job.provider.id,jobId:t.job.id,createdAt:new Date},y=await R.request({origin:"Web",method:"POST",url:H,data:_,authToken:d});if(A(!1),y.success&&y.data){const F=y.data;Z(!0),setTimeout(()=>{t.callbackSuccess({...F,type:t.type})},6e3)}else t.callbackError()}},c=()=>$?f():E(),E=()=>k==="denied"?e.jsx("div",{className:"font-semibold text-errorColor",children:"Permissão para acessar a câmera foi negada. Por favor, habilite o acesso à câmera nas configurações do navegador."}):k==="prompt"?e.jsx("div",{className:"font-semibold text-quaternaryColor",children:"Aguardando permissão para acessar a câmera..."}):k==="notFound"?e.jsx("div",{className:"font-semibold text-errorColor",children:"Nenhuma câmera foi encontrada. Por favor, conecte uma câmera e tente novamente."}):e.jsxs("div",{className:"flex flex-col justify-between w-full h-full",children:[e.jsx("div",{className:"flex justify-start w-full mb-1",children:e.jsx("span",{className:"text-tertiaryColor text-start",children:'Posicione a câmera frontal do seu dispositivo de frente para o seu rosto e aperte em "Capturar".'})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ht,{audio:!1,ref:i,screenshotFormat:"image/jpeg",videoConstraints:w}),e.jsxs("button",{type:"button",disabled:J,className:"flex items-center justify-center h-12 mt-4 font-bold transition-all duration-300 ease-in-out border-4 shadow-lg mobile:text-base shadow-primaryColor/40 border-primaryColor text-primaryColor rounded-xl hover:bg-primaryColor mobile:w-full hover:text-tertiaryColor disabled:cursor-not-allowed disabled:bg-primaryColor/80 disabled:text-tertiaryColor/80 disabled:border-primaryColor/20",onClick:u,children:[e.jsx(pt,{weight:"bold",size:22}),e.jsx("span",{className:"ml-2",children:"Tirar foto"})]})]})]}),f=()=>e.jsxs("div",{className:"flex flex-col justify-center w-full h-full",children:[e.jsx("span",{className:"w-full text-xl font-semibold text-center text-successColor",children:`${t.type==="in"?"Check-in":"Check-out"} realizado com sucesso`}),e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(tt,{className:"w-80 h-80",animationData:at,initialSegment:[0,120],loop:!1})})]}),G=()=>{b(null),A(!1),Z(!1),x(null),D("prompt")};return s.useEffect(()=>{G(),navigator.mediaDevices.getUserMedia({video:!0}).then(()=>{D("granted")}).catch(m=>{m.name==="NotAllowedError"||m.name==="PermissionDeniedError"?D("denied"):m.name==="NotFoundError"?D("notFound"):D("prompt")}),navigator.geolocation.getCurrentPosition(m=>{x({latitude:m.coords.latitude,longitude:m.coords.longitude})},m=>{console.error("Error getting location: ",m)})},[t.open]),e.jsxs(Re,{onClose:t.onClose,open:t.open,maxWidth:"xl",children:[e.jsx(qe,{className:"w-full text-xl font-bold text-center text-tertiaryColor bg-gradient-to-b from-primaryColor to-quaternaryColor",children:`${t.type==="in"?"Check-in":"Check-out"}`}),e.jsx($e,{edge:"end",onClick:t.onClose,"aria-label":"close",sx:{position:"absolute",top:"12px",right:"20px"},children:e.jsx(He,{})}),e.jsx(et,{className:"bg-[#222] flex justify-center items-center tablet:w-[22rem] mobile:w-[16rem] h-[26rem]",children:e.jsxs("div",{className:"flex flex-col items-center justify-around w-full h-full",children:[e.jsx("div",{className:"flex w-full h-full",children:c()}),J&&e.jsx(rt,{})]})})]})}function Ot({...t}){const{authToken:d}=we(),{dispatch:L}=Ne(),[i,q]=s.useState(null),[b,J]=s.useState("asc"),[A,$]=s.useState("date"),[Z,k]=s.useState(0),[D,g]=s.useState(10),[x,w]=s.useState({}),[u,N]=s.useState({}),[c,E]=s.useState({}),[f,G]=s.useState({}),[m,H]=s.useState({}),[S,_]=s.useState({}),[y,F]=s.useState({}),[ee,W]=s.useState({}),[X,re]=s.useState(!1),[M,te]=s.useState(!1),[z,C]=s.useState(!1),[I,O]=s.useState(0),[oe,ae]=s.useState(!1),[K,ne]=s.useState(null),le=s.useRef(!1),ce=async()=>{const o={},r={};if(d)for(const a of t.dataList){const j=await R.request({origin:"Web",method:"GET",url:`/jobs/${a.id}/payments`,authToken:d});if(j.success&&j.data){const p=j.data;p?(o[a.id]=p,r[a.id]=!1):(o[a.id]=null,r[a.id]=!1)}else o[a.id]=null,r[a.id]=!1}w(o),N(r)},Se=async()=>{const o={},r={};if(d)for(const a of t.dataList){const j=await R.request({origin:"Web",method:"GET",url:`/providers/${a.provider.id}/jobs/${a.id}/check-ins`,authToken:d});if(j.success&&j.data){const p=j.data;p?(o[a.id]={...p,type:"in"},r[a.id]=!1):(o[a.id]=null,r[a.id]=!1)}else o[a.id]=null,r[a.id]=!1}E(o),G(f)},be=async()=>{const o={},r={};if(d)for(const a of t.dataList){const j=await R.request({origin:"Web",method:"GET",url:`/providers/${a.provider.id}/jobs/${a.id}/check-outs`,authToken:d});if(j.success&&j.data){const p=j.data;p?(o[a.id]={...p,type:"out"},r[a.id]=!1):(o[a.id]=null,r[a.id]=!1)}else o[a.id]=null,r[a.id]=!1}H(o),_(S)},de=async()=>{const o={},r={};if(d)for(const a of t.dataList){const j=await R.request({origin:"Web",method:"GET",url:`/providers/${a.provider.id}/jobs/${a.id}/feedbacks`,authToken:d});if(j.success&&j.data){const p=j.data;p?(o[a.id]=p,r[a.id]=!1):(o[a.id]=null,r[a.id]=!1)}else o[a.id]=null,r[a.id]=!1}F(o),W(ee)},xe=()=>{const o=st("https://freela-servicos.duckdns.org");ne(o),o.on("providerCreatedJobCheckIn",r=>{E(a=>({...a,[r.jobId]:{...r,type:"in"}}))}),o.on("providerCreatedJobCheckOut",r=>{H(a=>({...a,[r.jobId]:{...r,type:"out"}}))}),o.on("providerCreatedJobFeedback",r=>{F(a=>({...a,[r.jobId]:{...r}}))})},he=()=>{if(re(!0),oe)t.callbackTerminate();else{const o=t.dataList.length-I;L({type:"SHOW_ALERT",payload:{type:"warning",text:`Todos serviços precisam ser encerrados para conclui-los, restam ${o}`}}),re(!1)}},pe=()=>{te(!0)},je=()=>{te(!1)},ye=()=>{C(!0)},Ce=()=>{C(!1)},Te=(o,r)=>{o&&(J(A===r&&b==="asc"?"desc":"asc"),$(r))},ge=(o,r)=>{if(o){const a=t.dataList.find(j=>j.id===r);a&&q(a)}},ue=(o,r)=>{o&&k(r)},fe=o=>{g(parseInt(o.target.value,10)),k(0)},U=[{id:" ",numeric:!1,disablePadding:!0,label:" "},{id:"name",numeric:!1,disablePadding:!1,label:"Nome"},{id:"phoneNumber",numeric:!1,disablePadding:!1,label:"Celular"},{id:"rating",numeric:!0,disablePadding:!1,label:"Avaliação"},{id:"status",numeric:!1,disablePadding:!1,label:"Status"},{id:"payment",numeric:!1,disablePadding:!1,label:"Pagamento"},{id:"checkIn",numeric:!1,disablePadding:!1,label:"Check in"},{id:"checkOut",numeric:!1,disablePadding:!1,label:"Check out"},{id:"feedback",numeric:!1,disablePadding:!1,label:"Feedback"}],B=yt(Ge)(({theme:o})=>({[`&.${_e.head}`]:{color:o.palette.common.black},[`&.${_e.body}`]:{width:"100%",fontSize:14}})),ie=()=>e.jsx(e.Fragment,{children:i&&e.jsxs(Ke,{className:"bg-[#222] flex flex-col justify-start",children:[e.jsxs("div",{className:"flex flex-row justify-center w-full my-3",children:[e.jsx("span",{className:"text-base font-semibold text-center text-tertiaryColor",children:"1 selecionado"}),e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsx("span",{className:"mx-2 text-base font-semibold text-center text-tertiaryColor",children:"-"}),e.jsxs("button",{onClick:pe,className:"relative transition-colors duration-300 group text-tertiaryColor hover:text-primaryColor disabled:text-tertiaryColor/50",disabled:X||M||z,children:[e.jsx("span",{className:"text-base font-semibold",children:"Ver perfil"}),e.jsx("span",{className:`${X||M||z?"hidden":"absolute left-0 w-full h-[0.20rem] transition-transform duration-300 transform scale-x-0 rounded-full -bottom-1 bg-tertiaryColor group-hover:bg-primaryColor group-hover:scale-x-100"}`})]})]})]}),e.jsxs("div",{className:"flex flex-col items-start justify-start w-full my-3",children:[e.jsxs("div",{className:"flex flex-row font-semibold text-tertiaryColor",children:["Check-in: ",c[i.id]?e.jsx("div",{className:"text-center text-successColor",children:`Realizado em ${me.formatDateAndTimeToBR(c[i.id].createdAt)}`}):e.jsx("div",{className:"text-center text-quaternaryColor",children:"Em espera"})]}),e.jsxs("div",{className:"flex flex-row mt-1 font-semibold text-tertiaryColor",children:["Check-out: ",m[i.id]?e.jsx("div",{className:"text-center text-successColor",children:`Realizado em ${me.formatDateAndTimeToBR(m[i.id].createdAt)}`}):e.jsx("div",{className:"text-center text-quaternaryColor",children:"Em espera"})]}),e.jsxs("div",{className:"flex flex-row mt-1 font-semibold text-tertiaryColor",children:["Feedback: ",y[i.id]?e.jsx("div",{className:"text-center text-successColor",children:`Avaliado em ${me.formatDateAndTimeToBR(y[i.id].createdAt)}`}):"-"]})]})]})}),se=(o,r,a)=>{const j=p=>Ae=>{o(Ae,p)};return e.jsx(wt,{children:e.jsx(Xe,{children:U.map(p=>e.jsx(Ge,{align:"left",padding:p.disablePadding?"none":"normal",sortDirection:a===p.id?r:!1,sx:{fontWeight:"bold"},children:e.jsxs(Nt,{active:a===p.id,direction:a===p.id?r:"asc",onClick:j(p.id),children:[p.label,a===p.id?e.jsx(St,{component:"span",sx:Tt,children:r==="desc"?"sorted descending":"sorted ascending"}):null]})},p.id))})})},Pe=()=>e.jsxs(Ke,{className:"bg-[#222] flex flex-col justify-start",children:[e.jsx("div",{className:"flex flex-row justify-start w-full mt-3",children:e.jsx("span",{className:"text-base font-semibold text-center text-primaryColor",children:`Serviços concluídos: ${I}/${t.dataList.length}`})}),e.jsx("div",{className:"flex items-center justify-center w-full my-3",children:e.jsx("button",{className:"w-[65%] flex items-center justify-center h-12 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-primaryColor shadow-primaryColor/40 text-primaryColor hover:text-tertiaryColor rounded-xl hover:bg-primaryColor disabled:cursor-not-allowed disabled:bg-primaryColor/50 disabled:text-tertiaryColor/80 disabled:border-primaryColor/10",onClick:he,disabled:X||M||z||I!==t.dataList.length,children:X?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Y,{weight:"bold",className:"w-6 h-6 mr-2 animate-spin"}),e.jsx("span",{children:"Concluindo..."})]}):e.jsx("span",{children:"Concluir"})})})]}),Je=o=>e.jsx("img",{src:o,alt:"Imagem de perfil do Freelancer que se candidatou",className:"w-16 h-16 rounded-full"}),De=(o,r)=>e.jsxs("div",{className:"flex flex-row items-center justify-start",children:[r!=="Não possuo"&&e.jsx("img",{title:"O freelancer é portador de deficiência",src:Ye.disabledPeople.source,alt:Ye.disabledPeople.alternativeText,className:"w-8 h-8 mr-2 rounded-full"}),e.jsx("span",{children:o})]}),Ee=o=>e.jsx("div",{className:"text-center",children:o}),Ie=o=>e.jsxs("div",{className:"flex flex-row items-center justify-start",children:[e.jsx(ot,{readOnly:!0,value:o}),o===0&&e.jsx("span",{className:"text-sm",children:"(Nenhuma avaliação)"})]}),Be=o=>{let r="#fff",a="";switch(o){case"scheduled":r="#FF9E00",a="Agendado";break;case"in progress":r="#FF9E00",a="Em andamento";break;case"partially completed":r="#03C03C",a="Parcialmente completo";break;case"completed":r="#03C03C",a="Completo";break;default:r="#fff",a=""}return e.jsx("div",{className:`${r} text-center`,children:a})},Le=()=>{le.current=!1;const o={};t.dataList.forEach(r=>{o[r.id]=!0}),N(o),G(o),_(o),W(o),q(null),J("asc"),$("date"),k(0),g(10),w({}),E({}),H({}),F({}),re(!1),te(!1),C(!1),O(0),ae(!1),ne(null)};return s.useEffect(()=>{let o=0;for(const r of t.dataList)x[r.id]&&c[r.id]&&m[r.id]&&y[r.id]&&o++;O(o),o===t.dataList.length&&ae(!0)},[x,c,m,y]),s.useEffect(()=>{if(t.open)return Le(),le.current?void 0:(le.current=!0,ce(),Se(),be(),de(),xe(),()=>{K&&K.connected&&(K.off("providerCreatedJobCheckIn"),K.off("providerCreatedJobCheckOut"),K.off("providerCreatedJobFeedback"),K.disconnect())})},[t.open]),e.jsxs(e.Fragment,{children:[e.jsxs(Re,{onClose:t.onClose,open:t.open,PaperProps:{sx:{margin:"0",width:"95%"}},disableScrollLock:!0,children:[e.jsx(qe,{className:"w-full text-xl font-bold text-center text-tertiaryColor bg-gradient-to-b from-primaryColor to-quaternaryColor",children:"Serviços"}),e.jsx($e,{edge:"end",onClick:t.onClose,"aria-label":"close",sx:{position:"absolute",top:"12px",right:"20px"},disabled:X||M||z,children:e.jsx(He,{})}),ie(),e.jsx(Ct,{component:"div",className:"flex",children:e.jsxs(gt,{sx:{minWidth:700},"aria-label":"customized table",children:[se(Te,b,A),e.jsx(vt,{children:t.dataList.map(o=>{var a;const r=(i==null?void 0:i.id)===o.id;return e.jsxs(Xe,{hover:!0,onClick:j=>ge(j,o.id),role:"checkbox","aria-checked":r,tabIndex:-1,selected:r,sx:{cursor:"pointer","&.Mui-selected":{backgroundColor:"rgba(255, 158, 0, 0.4)"},"&:hover":{backgroundColor:"rgba(255, 158, 0, 0.2)"},"&.Mui-selected:hover":{backgroundColor:"rgba(255, 158, 0, 0.5)"}},children:[e.jsx(B,{children:Je(o.provider.image)}),e.jsx(B,{align:"left",children:De(o.provider.name,o.provider.deficiency)}),e.jsx(B,{align:"left",children:Ee(o.provider.phoneNumber)}),e.jsx(B,{align:"left",children:Ie(o.provider.feedbackStars)}),e.jsx(B,{align:"left",children:Be(o.status)}),e.jsx(B,{align:"left",children:u[o.id]?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Y,{weight:"bold",className:"w-6 h-6 animate-spin text-quinaryColor"})}):x[o.id]&&((a=x[o.id])==null?void 0:a.status)==="paid"?e.jsx("div",{className:"font-semibold text-center text-successColor",children:"Pago"}):e.jsx("div",{className:"font-semibold text-center text-quinaryColor",children:"Pendente"})}),e.jsx(B,{align:"left",children:f[o.id]?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Y,{weight:"bold",className:"w-6 h-6 animate-spin text-quinaryColor"})}):c[o.id]?e.jsx("div",{className:"flex items-center jsutify-center",children:e.jsx(ke,{weight:"bold",className:"w-6 h-6 text-successColor"})}):e.jsx("div",{className:"font-semibold text-center text-quaternaryColor",children:"Em espera"})}),e.jsx(B,{align:"left",children:S[o.id]?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Y,{weight:"bold",className:"w-6 h-6 animate-spin text-quinaryColor"})}):m[o.id]?e.jsx("div",{className:"flex items-center jsutify-center",children:e.jsx(ke,{weight:"bold",className:"w-6 h-6 text-successColor"})}):e.jsx("div",{className:"font-semibold text-center text-quaternaryColor",children:"Em espera"})}),e.jsx(B,{align:"left",children:ee[o.id]?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Y,{weight:"bold",className:"w-6 h-6 animate-spin text-quinaryColor"})}):y[o.id]?e.jsx("div",{className:"flex items-center jsutify-center",children:e.jsx(ke,{weight:"bold",className:"w-6 h-6 text-successColor"})}):x[o.id]&&c[o.id]&&m[o.id]||!V().isBefore(V(o.date).add(Number(o.time.split(" horas")[0]),"hour"))?e.jsx("button",{className:"flex items-center justify-center w-full h-12 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-quaternaryColor shadow-quaternaryColor/40 text-quaternaryColor hover:text-tertiaryColor rounded-xl hover:bg-quaternaryColor disabled:cursor-not-allowed disabled:bg-quaternaryColor/50 disabled:text-tertiaryColor/80 disabled:border-quaternaryColor/10",onClick:ye,disabled:X||M||z,children:z?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Y,{weight:"bold",className:"w-6 h-6 mr-2 animate-spin"}),e.jsx("span",{children:"Avaliando..."})]}):e.jsx("span",{children:"Avaliar"})}):e.jsx("div",{className:"font-semibold text-center text-secondaryColor",children:"-"})})]},o.id)})})]})}),e.jsx(kt,{rowsPerPageOptions:[5,10,25],component:"div",count:t.dataList.length,rowsPerPage:D,page:Z,onPageChange:ue,onRowsPerPageChange:fe,labelRowsPerPage:"Linhas por página",labelDisplayedRows:({from:o,to:r,count:a})=>`Exibindo ${o}-${r} de ${a+(a>1?" linhas":" linha")}`}),Pe()]}),i&&e.jsx(Bt,{providerId:i.provider.id,open:M,onClose:je}),i&&e.jsx(nt,{profileType:"contractor",job:i,open:z,onClose:Ce,callbackSuccess:o=>{Ce(),W(r=>({...r,[o.jobId]:!0})),o&&F(r=>({...r,[o.jobId]:o})),W(r=>({...r,[o.jobId]:!1}))},callbackError:()=>{L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao enviar o feedback"}})}})]})}function Vt({...t}){const{authToken:d}=we(),{dispatch:L}=Ne(),{dispatch:i}=Ft(),{getUser:q}=Lt(),b=s.useRef(null),J=s.useRef(!1),A=s.useRef(!1),$=s.useRef(!1),Z=s.useRef(!1),k=s.useRef(!1),D=s.useRef(!1),g=s.useRef(!1),[x,w]=s.useState(null),[u,N]=s.useState(null),[c,E]=s.useState(null),[f,G]=s.useState([]),[m,H]=s.useState(null),[S,_]=s.useState(null),[y,F]=s.useState("-"),[ee,W]=s.useState(""),[X,re]=s.useState(!1),[M,te]=s.useState(!1),[z,C]=s.useState(!1),[I,O]=s.useState(!1),[oe,ae]=s.useState(null),[K,ne]=s.useState(null),[le,ce]=s.useState(null),[Se,be]=s.useState(!1),[de,xe]=s.useState(!1),[he,pe]=s.useState(!1),[je,ye]=s.useState(!1),[Ce,Te]=s.useState(!0),[ge,ue]=s.useState(!1),[fe,U]=s.useState(!1),[B,ie]=s.useState(!1),[se,Pe]=s.useState(null),Je=async()=>{if(J.current=!0,d&&t.jobs&&t.jobs.length>0){const n=await R.request({origin:"Web",method:"GET",url:`/vacancies/${t.jobs[0].vacancyId}`,authToken:d});if(n.success&&n.data){const l=n.data;if(l){w(l);const h=V(new Date),v=V(l.jobDate),T=Number(l.jobTime.split(" horas")[0]),Q=v.add(T,"hour");if(h.isAfter(v)&&h.isBefore(Q)){const P=V(Q).diff(h);_(P)}}else w(null)}else w(null)}},De=async()=>{if(A.current=!0,d&&b.current){const n=await R.request({origin:"Web",method:"GET",url:`/contractors/${b.current.contractorId}`,authToken:d});if(n.success&&n.data){const l=n.data;N(l||null)}else N(null)}},Ee=async()=>{if($.current=!0,d&&t.jobs&&t.jobs.length>0){if(b.current&&u){const n=await q(u.userId);if(n){let l=0;const h=[],v=[];for(const T of t.jobs){l===0&&H(T.value);const Q=await R.request({origin:"Web",method:"GET",url:`providers/${T.providerId}`,authToken:d});if(Q.success&&Q.data){const P=Q.data,Fe=new Uint8Array(P.profileImage.data).buffer,ft=new Blob([Fe],{type:"image/jpeg"}),Oe=URL.createObjectURL(ft),ve=await q(P.userId);if(ve){if(h.push({id:T.id,title:b.current.assignment,value:b.current.jobValue,status:T.status,date:b.current.jobDate,time:b.current.jobTime,contractor:{id:u.id,image:Oe,name:n.name,phoneNumber:n.phoneNumber,feedbackStars:u.feedbackStars},provider:{id:P.id,image:Oe,name:ve.name,phoneNumber:ve.phoneNumber,feedbackStars:P.feedbackStars,deficiency:P.deficiency},vacancyId:b.current.id}),t.profileType==="contractor")v.push({id:P.id,image:Oe,name:ve.name,city:P.city,phone:P.phoneMessage,rating:P.feedbackStars,deficiency:P.deficiency,date:me.formatDateAndTimeToBR(T.createdAt)});else if(t.profileType==="provider")break}}l++}G(h)}}}else G([])},Ie=async n=>{if(d&&n){const l=await R.request({origin:"Web",method:"GET",url:`/providers/${n.provider.id}/jobs/${n.id}/check-ins`,authToken:d});if(l.success&&l.data){const h=l.data;ae({...h,type:"in"})}}},Be=async n=>{if(d&&n){const l=await R.request({origin:"Web",method:"GET",url:`/providers/${n.provider.id}/jobs/${n.id}/check-outs`,authToken:d});if(l.success&&l.data){const h=l.data;ne({...h,type:"out"})}}},Le=async n=>{if(d&&n){const l=await R.request({origin:"Web",method:"GET",url:`/contractors/${n.contractor.id}/jobs/${n.id}/feedbacks`,authToken:d});if(l.success&&l.data){const h=l.data;ce(h)}}},o=async n=>{if(!k.current){k.current=!0;try{t.onStart&&await t.onStart(n)}catch(l){k.current=!1,console.error("Error starting job:",l)}}},r=async n=>{if(!n&&t.onCancel&&await t.onCancel(),!g.current){g.current=!0;try{t.onCancel&&await t.onCancel(n)}catch(l){g.current=!1,console.error("Error canceling job:",l)}}},a=async n=>{if(!n&&t.onTerminate&&await t.onTerminate(),!D.current){D.current=!0;try{t.onTerminate&&await t.onTerminate(n)}catch(l){D.current=!1,console.error("Error terminating job:",l)}}},j=()=>{ue(!0),c&&oe?o(c.id):it()},p=()=>{ie(!0),i({type:"SHOW_CONFIRMATION",payload:{title:"Confirmar cancelamento do serviço",message:"Deseja cancelar e desmarcar o serviço?",onConfirm:()=>{t.profileType==="contractor"?(r(),ie(!1)):t.profileType==="provider"?c&&(r(c.id),ie(!1)):console.error("Unknown profileType")},onCancel:()=>{ie(!1)}}})},Ae=()=>{if(U(!0),t.profileType==="contractor")We();else if(t.profileType==="provider"){if(c){if(!oe){L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao verificar o check-in do serviço"}}),U(!1);return}if(!K){ct();return}if(!le){Ue();return}a(c.id),U(!1)}}else console.error("Unknown profileType")},We=()=>{U(!0),be(!0)},lt=()=>{U(!1),be(!1)},it=()=>{ue(!0),xe(!0)},Me=()=>{ue(!1),xe(!1)},ct=()=>{U(!0),pe(!0)},ze=()=>{U(!1),pe(!1)},Ue=()=>{U(!0),ye(!0)},Ve=()=>{U(!1),ye(!1)},dt=()=>{if(Ce)return e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsx(Y,{weight:"bold",className:"w-6 h-6 animate-spin text-primaryColor"})});if(I){if(z)return e.jsx("button",{onClick:Ae,className:"flex items-center justify-center h-12 mt-4 font-bold transition-all duration-300 ease-in-out border-4 shadow-lg mobile:text-base shadow-quaternaryColor/40 border-quaternaryColor text-quaternaryColor rounded-xl hover:bg-quaternaryColor mobile:w-full hover:text-tertiaryColor disabled:cursor-not-allowed disabled:bg-quaternaryColor/80 disabled:text-tertiaryColor/80 disabled:border-quaternaryColor/20",disabled:fe||de||he||je,children:fe?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Y,{weight:"bold",className:"w-6 h-6 mr-3 animate-spin"}),e.jsx("span",{children:"Encerrando..."})]}):e.jsx("span",{children:t.profileType==="contractor"?"Encerrar serviços":t.profileType==="provider"&&"Encerrar serviço"})})}else{if(X)return e.jsx("button",{onClick:p,className:"flex items-center justify-center h-12 mt-4 font-bold transition-all duration-300 ease-in-out border-4 shadow-lg mobile:text-base shadow-errorColor/40 border-errorColor text-errorColor rounded-xl hover:bg-errorColor mobile:w-full hover:text-tertiaryColor disabled:cursor-not-allowed disabled:bg-errorColor/80 disabled:text-tertiaryColor/80 disabled:border-errorColor/20",disabled:B,children:B?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Y,{weight:"bold",className:"w-6 h-6 mr-3 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsx("span",{children:t.profileType==="contractor"?"Cancelar e desmarcar serviços":t.profileType==="provider"&&"Cancelar e desmarcar serviço"})});if(t.profileType==="provider"&&M)return e.jsx("button",{onClick:j,className:"flex items-center justify-center h-12 mt-4 font-bold transition-all duration-300 ease-in-out border-4 shadow-lg mobile:text-base shadow-quaternaryColor/40 border-quaternaryColor text-quaternaryColor rounded-xl hover:bg-quaternaryColor mobile:w-full hover:text-tertiaryColor disabled:cursor-not-allowed disabled:bg-quaternaryColor/80 disabled:text-tertiaryColor/80 disabled:border-quaternaryColor/20",disabled:ge||de,children:ge?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Y,{weight:"bold",className:"w-6 h-6 mr-3 animate-spin"}),e.jsx("span",{children:"Iniciando..."})]}):e.jsx("span",{children:"Iniciar serviço"})})}return null},ut=()=>{const n=st("https://freela-servicos.duckdns.org");Pe(n),n.on("providerCreatedJobCheckIn",l=>{if(l&&(ae({...l,type:"in"}),t.profileType==="contractor"||t.profileType==="provider"&&O(!0),b.current)){const h=V(new Date),v=V(b.current.jobDate),T=Number(b.current.jobTime.split(" horas")[0]),Q=v.add(T,"hour");C(h.isAfter(Q))}}),n.on("providerCreatedJobCheckOut",l=>{l&&(ne({...l,type:"out"}),t.profileType==="contractor"||t.profileType==="provider"&&O(!0),C(!0))}),n.on("providerCreatedJobFeedback",l=>{l&&(ce(l),t.profileType==="contractor"?C(!0):t.profileType==="provider"&&(O(!0),C(!1)))})};return s.useEffect(()=>{if(S){const n=setInterval(()=>{_(l=>{if(l&&l>1e3){const h=l-1e3,v=Math.floor(h/1e3),T=Math.floor(v/3600),Q=Math.floor(v%3600/60),P=v%60,Fe=`${T.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}:${P.toString().padStart(2,"0")}`;return F(Fe),h}else return F("-"),clearInterval(n),null})},1e3);return()=>{clearInterval(n)}}},[S]),s.useEffect(()=>{if(u&&b.current&&f&&f.length===t.jobs.length){const n=V(new Date),l=V(b.current.jobDate),h=Number(b.current.jobTime.split(" horas")[0]),v=l.add(h,"hour"),T=l.subtract(2,"hour");re(n.isBefore(T)||n.isSame(T)),t.profileType==="contractor"?oe&&(O(l.isBefore(n)),C(n.isAfter(v))):t.profileType==="provider"&&t.provider&&c&&(c.status==="scheduled"?n.isSame(l)||n.isAfter(l)?te(!0):te(!1):(c.status==="in progress"||c.status==="completed")&&oe&&(O(l.isBefore(n)),C(n.isAfter(v)))),Te(!1)}},[b.current,u,f,c,oe,K,le]),s.useEffect(()=>{if(f&&f.length>0){let n=!1;const l=()=>{W(n?`${f.length} ${f.length===1?"Freelancer":"Freelancers"}`:"Toque para ver!"),n=!n},h=setInterval(l,4e3);return l(),()=>clearInterval(h)}},[f]),s.useEffect(()=>{const n=async l=>{await Promise.all([Ie(l),Be(l),Le(l)])};if(f&&f.length===t.jobs.length){if(Z.current)return;if(t.profileType==="provider"&&t.provider){const l=f.find(h=>{var v;return h.provider.id===((v=t.provider)==null?void 0:v.id)&&h.status!=="canceled"&&h.status!=="unavailable"});l&&(Z.current=!0,E(l),n(l))}}},[f]),s.useEffect(()=>{if(u){if($.current)return;Ee()}},[u]),s.useEffect(()=>{A.current||x&&(b.current=x,De())},[x]),s.useEffect(()=>{if(!J.current)return(async()=>{await Je(),ut()})(),()=>{se&&se.connected&&(se.off("providerCreatedJobCheckIn"),se.off("providerCreatedJobCheckOut"),se.off("providerCreatedJobFeedback"),se.disconnect())}},[]),e.jsxs(e.Fragment,{children:[x&&u&&m&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative flex flex-col w-full px-6 py-6 border-2 rounded-lg border-primaryColor",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(At,{assignment:`${x.assignment}`}),e.jsx("span",{className:"ml-2 text-xl font-semibold text-center text-primaryColor",children:x.assignment.toUpperCase()})]}),e.jsxs("div",{className:"flex items-center justify-start mt-4 text-tertiaryColor",children:[e.jsx(Pt,{size:24,weight:"regular"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:"font-semibold",children:"Estabelecimento:"})," "+x.establishment]})]}),e.jsxs("div",{className:"flex items-center justify-start mt-2 text-tertiaryColor",children:[e.jsx(Jt,{size:24,weight:"regular"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:"font-semibold",children:"Localização:"}),u&&" "+u.city+" - "+u.uf]})]}),e.jsxs("div",{className:"flex items-center justify-start mt-2 text-tertiaryColor",children:[e.jsx(Dt,{size:24,weight:"regular"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:"font-semibold",children:"Data do serviço:"})," "+me.formatDateAndTimeToBR(x.jobDate)]})]}),e.jsxs("div",{className:"flex items-center justify-start mt-2 text-tertiaryColor",children:[e.jsx(Et,{size:24,weight:"regular"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:"font-semibold",children:t.profileType==="contractor"?"Valor a ser pago:":"Valor a receber:"})," "+(t.profileType==="contractor"?Qe.getJobValueByProfile(t.profileType,x.jobValue,x.quantity):Qe.getJobValueByProfile(t.profileType,x.jobValue,void 0,"R$1,00"))]})]}),!K&&V(new Date).isAfter(V(x.jobDate))&&e.jsxs("div",{className:"flex items-center justify-start mt-2 text-tertiaryColor",children:[e.jsx(It,{size:24,weight:"regular"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:"font-semibold",children:"Tempo restante:"})," "+y]})]}),e.jsx("div",{className:"flex justify-end mt-1 text-tertiaryColor",children:t.profileType==="contractor"&&e.jsx("button",{type:"button",disabled:!f||f.length===0||B||fe,className:"font-semibold text-end text-primaryColor disabled:text-tertiaryColor/50",onClick:We,children:ee&&ee.length>0&&ee})}),dt()]})}),t.profileType==="contractor"&&f&&f.length>0&&e.jsx(Ot,{dataList:f,open:Se,onClose:lt,callbackTerminate:()=>{a()}}),t.profileType==="provider"&&c&&e.jsx(Ze,{type:"in",job:c,open:de,onClose:Me,callbackSuccess:n=>{n&&n.type==="in"&&(ae(n),Me(),o(c.id))},callbackError:()=>{L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao realizar o check-in do serviço"}})}}),t.profileType==="provider"&&c&&e.jsx(Ze,{type:"out",job:c,open:he,onClose:ze,callbackSuccess:n=>{n&&n.type==="out"&&(ne(n),ze(),Ue())},callbackError:()=>{L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao realizar o check-out do serviço"}})}}),t.profileType==="provider"&&c&&e.jsx(nt,{profileType:t.profileType,job:c,open:je,onClose:Ve,callbackSuccess:n=>{n&&(ce(n),Ve(),a(c.id))},callbackError:()=>{L({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao enviar o feedback"}})}})]})}export{Vt as J};

import{r as u,E as Ie,T as Ne,F,j as o,C as k,J as Re,K as Oe,M as Ee,O as Je,P as A,Q as Fe,V as Ae,X as De,Y as Be,Z as qe}from"./vendor-LjbCKWXj.js";import{M as Ge}from"./Menu-9s0U-oCf.js";import{u as We,a as ze,A as p}from"./index-B-GzxfbT.js";import{S as _,a as K,C}from"./Select-C8PQA4vz.js";function _e(){const{authToken:b}=We(),{dispatch:Q}=ze(),D=u.useRef(!1),[B,X]=u.useState(null),[Y,Z]=u.useState(!0),[V,P]=u.useState(),[g,q]=u.useState("Todas"),[h,G]=u.useState("Todos"),[T,I]=u.useState([]),[ee,N]=u.useState([]),[se,R]=u.useState([]),[te,O]=u.useState([]),[n,x]=u.useState({registrations:{},openVacancies:{},closedVacancies:{},jobsInProgress:{},executedJobs:{}}),[ae,L]=u.useState(!0),[oe,W]=u.useState(!0),[re,z]=u.useState(!0),[ne,S]=u.useState(!0),[w,E]=u.useState(!0),[$,J]=u.useState(!1),[H,ce]=u.useState("asc"),[j,ie]=u.useState(""),[le,U]=u.useState({value:"Todas",label:"Todas"}),[de,M]=u.useState({value:"Todos",label:"Todos"}),ue=(c,e)=>{e&&(e.action==="clear"?(U({value:"Todas",label:"Todas"}),q("Todas")):c&&"value"in c&&(U(c),q(c.value)))},me=(c,e)=>{e&&(e.action==="clear"?(M({value:"Todos",label:"Todos"}),G("Todos")):c&&"value"in c&&(M(c),G(c.value)))},be=async()=>{if(D.current=!0,b){const c=await p.request({origin:"Web",method:"GET",url:"/cities",authToken:b});if(c.success&&c.data){const e=c.data;if(e.length>0){const t=[];e.map(i=>{t.push({value:i,label:i})}),P(t)}else P([])}else P([])}},ge=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=await p.request({origin:"Web",method:"GET",url:"/admins/users/registrations",params:{city:g!=="Todas"?g:void 0,lastDays:e||void 0},authToken:b,signal:c});if(t.success&&t.data){const i=t.data;return i.length>0?(I(i),L(!1)):(I([]),L(!1)),!0}else return I([]),L(!1),!1}return!1},fe=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=C.getVacancyCombo().map(r=>r.value),i={};for(const r of t)i[r]=0;let l=null,s=null;const a={city:g!=="Todas"?g:void 0,lastDays:e||void 0};if([l,s]=await Promise.all([p.request({origin:"Web",method:"GET",url:"/admins/contractors",params:a,authToken:b,signal:c}),p.request({origin:"Web",method:"GET",url:"/admins/providers",params:a,authToken:b,signal:c})]),l&&l.success&&l.data){const r=l.data;if(r.length>0){N(r);for(const d of r)for(const y of t)d.vacancies.includes(y)&&i[y]++}else N([])}else N([]);if(s&&s.success&&s.data){const r=s.data;if(r.length>0){R(r);for(const d of r)for(const y of t)d.desiredJobVacancy.includes(y)&&i[y]++}else R([])}else R([]);return l&&l.success&&s&&s.success&&(W(!1),z(!1),x(r=>({...r,registrations:{...i}}))),!0}return!1},he=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=await p.request({origin:"Web",method:"GET",url:"/access",params:{lastDays:e||void 0},authToken:b,signal:c});if(t.success&&t.data){const i=t.data;return i.length>0?(O(i),S(!1)):(O([]),S(!1)),!0}else return O([]),S(!1),!1}return!1},xe=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=C.getVacancyCombo().map(s=>s.value),i={};for(const s of t)i[s]=0;const l=await p.request({origin:"Web",method:"GET",url:"/admins/open-vacancies",params:{city:g!=="Todas"?g:void 0,expired:!1,lastDays:e||void 0},authToken:b,signal:c});if(l.success&&l.data){const s=l.data;if(s.length>0)for(const a of s)for(const r of t)a.assignment===r&&i[r]++;return x(a=>({...a,openVacancies:{...i}})),!0}else return x(s=>({...s,openVacancies:{...i}})),!1}return!1},pe=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=C.getVacancyCombo().map(s=>s.value),i={};for(const s of t)i[s]=0;const l=await p.request({origin:"Web",method:"GET",url:"/admins/closed-vacancies",params:{city:g!=="Todas"?g:void 0,lastDays:e||void 0},authToken:b,signal:c});if(l.success&&l.data){const s=l.data;if(s.length>0)for(const a of s)for(const r of t)a.assignment===r&&i[r]++;return x(a=>({...a,closedVacancies:{...i}})),!0}else return x(s=>({...s,closedVacancies:{...i}})),!1}return!1},je=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=C.getVacancyCombo().map(s=>s.value),i={};for(const s of t)i[s]=0;const l=await p.request({origin:"Web",method:"GET",url:"/admins/jobs-in-progress",params:{city:g!=="Todas"?g:void 0,lastDays:e||void 0},authToken:b,signal:c});if(l.success&&l.data){const s=l.data;if(s.length>0)for(const a of s)for(const r of t)a.vacancy.assignment===r&&i[r]++;return x(a=>({...a,jobsInProgress:{...i}})),!0}else return x(s=>({...s,jobsInProgress:{...i}})),!1}return!1},ye=async c=>{if(b){let e=null;switch(h){case"Últimas 24 horas":e=1;break;case"Última semana":e=7;break;case"Último mês":e=30;break;case"Últimos 3 meses":e=90;break;case"Último ano":e=365;break}const t=C.getVacancyCombo().map(s=>s.value),i={};for(const s of t)i[s]=0;const l=await p.request({origin:"Web",method:"GET",url:"/admins/closed-jobs",params:{city:g!=="Todas"?g:void 0,expired:!0,lastDays:e||void 0},authToken:b,signal:c});if(l.success&&l.data){const s=l.data;if(s.length>0)for(const a of s)for(const r of t)a.vacancy.assignment===r&&i[r]++;return x(a=>({...a,executedJobs:{...i}})),!0}else return x(s=>({...s,executedJobs:{...i}})),!1}return!1},Ce=()=>{B&&B.abort("Operation canceled by the user")},ve=async()=>{Z(!1),L(!0),W(!0),z(!0),S(!0),E(!0);let c=0;const e=7;try{Ce();const t=new AbortController;X(t),c=(await Promise.all([ge(t.signal),fe(t.signal),he(t.signal),xe(t.signal),pe(t.signal),je(t.signal),ye(t.signal)])).filter(l=>l).length}catch(t){console.error(t==null?void 0:t.toString()),E(!1)}finally{c===e&&E(!1)}},ke=async()=>{J(!0);let c;if(j!=="")switch(j){case"assignment":c=n.openVacancies;break;case"registrations":c=n.registrations;break;case"openVacancies":c=n.openVacancies;break;case"closedVacancies":c=n.closedVacancies;break;case"jobsInProgress":c=n.jobsInProgress;break;case"executedJobs":c=n.executedJobs;break;default:console.log("Invalid orderBy: "+j);break}else{const e=C.getVacancyCombo().map(t=>({[t.value]:[]}));c=Object.assign({},...e)}if(c){const e=new qe.Workbook,t=e.addWorksheet("Cadastros");t.addRow(`Cidade: ${g}`),t.getCell("A1").value={richText:[{text:"Cidade: ",font:{bold:!0}},{text:g}]},t.addRow(`Período: ${h}`),t.getCell("A2").value={richText:[{text:"Período: ",font:{bold:!0}},{text:h}]},t.addRow([" "]),t.addRow(["Cargo","Cadastros","Vagas em aberto","Vagas fechadas","Serviços em andamento","Serviços executados"]);const i=t.getRow(4);i.eachCell(m=>{m.alignment={horizontal:"left",vertical:"middle"},m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},m.font={color:{argb:"FFFFFF"}}}),i.height=30,Object.keys(c).forEach(m=>{t.addRow([m,n.registrations[m],n.openVacancies[m],n.closedVacancies[m],n.jobsInProgress[m],n.executedJobs[m]])}),t.addRow(["Total",T.length,Object.keys(n.openVacancies).reduce((m,v)=>m+n.openVacancies[v],0),Object.keys(n.closedVacancies).reduce((m,v)=>m+n.closedVacancies[v],0),Object.keys(n.jobsInProgress).reduce((m,v)=>m+n.jobsInProgress[v],0),Object.keys(n.executedJobs).reduce((m,v)=>m+n.executedJobs[v],0)]);const l=t.getRow(Object.keys(n.openVacancies).length+5);l.eachCell(m=>{m.alignment={horizontal:"left",vertical:"middle"},m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},m.font={color:{argb:"FFFFFF"}}}),l.height=20,t.getColumn("A").width=60,t.getColumn("A").alignment={horizontal:"left",vertical:"middle"},t.getColumn("B").width=25,t.getColumn("B").alignment={horizontal:"center",vertical:"middle"},t.getColumn("C").width=25,t.getColumn("C").alignment={horizontal:"center",vertical:"middle"},t.getColumn("D").width=25,t.getColumn("D").alignment={horizontal:"center",vertical:"middle"},t.getColumn("E").width=25,t.getColumn("E").alignment={horizontal:"center",vertical:"middle"},t.getColumn("F").width=25,t.getColumn("F").alignment={horizontal:"center",vertical:"middle"};const s=await e.xlsx.writeBuffer(),a=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(a),d=document.createElement("a");d.href=r;const y=new Date,Se=y.toISOString().split("T")[0],Pe=y.toLocaleTimeString().replace(/:/g,".");d.download=`cadastros${Se}_${Pe}.xlsx`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(r),J(!1)}else Q({type:"SHOW_ALERT",payload:{type:"error",text:"Houve um erro ao gerar o arquivo Excel"}}),console.log("generalRegistrationList is not defined"),J(!1)},we=[{id:"assignment",numeric:!1,disablePadding:!1,label:"Cargo"},{id:"registrations",numeric:!0,disablePadding:!1,label:"Cadastros"},{id:"openVacancies",numeric:!0,disablePadding:!1,label:"Vagas em aberto"},{id:"closedVacancies",numeric:!0,disablePadding:!1,label:"Vagas fechadas"},{id:"jobsInProgress",numeric:!0,disablePadding:!1,label:"Serviços em andamento"},{id:"executedJobs",numeric:!0,disablePadding:!1,label:"Serviços executados"}],f=Ie(Ne)(({theme:c})=>({[`&.${F.head}`]:{backgroundColor:"#FFCE08",color:"#222222",fontWeight:"bold",border:"none"},[`&.${F.body}`]:{fontSize:14,color:c.palette.common.white,borderColor:"#FFCE08"},[`&.${F.footer}`]:{fontSize:14,fontWeight:"bold",border:"none",color:"#222222"}})),Ve=(c,e)=>{if(c){const t=j===e&&H==="asc";ce(t?"desc":"asc"),ie(e);const i={...n};switch(e){case"assignment":{Object.keys(n).forEach(l=>{switch(l){case"registrations":{const s=Object.keys(n.registrations).sort((a,r)=>t?a.localeCompare(r):r.localeCompare(a));i.registrations=s.reduce((a,r)=>(a[r]=n.registrations[r],a),{});break}case"openVacancies":{const s=Object.keys(n.openVacancies).sort((a,r)=>t?a.localeCompare(r):r.localeCompare(a));i.openVacancies=s.reduce((a,r)=>(a[r]=n.openVacancies[r],a),{});break}case"closedVacancies":{const s=Object.keys(n.closedVacancies).sort((a,r)=>t?a.localeCompare(r):r.localeCompare(a));i.closedVacancies=s.reduce((a,r)=>(a[r]=n.closedVacancies[r],a),{});break}case"jobsInProgress":{const s=Object.keys(n.jobsInProgress).sort((a,r)=>t?a.localeCompare(r):r.localeCompare(a));i.jobsInProgress=s.reduce((a,r)=>(a[r]=n.jobsInProgress[r],a),{});break}case"executedJobs":{const s=Object.keys(n.executedJobs).sort((a,r)=>t?a.localeCompare(r):r.localeCompare(a));i.executedJobs=s.reduce((a,r)=>(a[r]=n.executedJobs[r],a),{});break}default:{console.log("Invalid key: "+l);break}}});break}case"registrations":{const l=Object.keys(n.registrations).sort((s,a)=>{const r=n.registrations[s],d=n.registrations[a];return t?r-d:d-r});i.registrations=l.reduce((s,a)=>(s[a]=n.registrations[a],s),{});break}case"openVacancies":{const l=Object.keys(n.openVacancies).sort((s,a)=>{const r=n.openVacancies[s],d=n.openVacancies[a];return t?r-d:d-r});i.openVacancies=l.reduce((s,a)=>(s[a]=n.openVacancies[a],s),{});break}case"closedVacancies":{const l=Object.keys(n.closedVacancies).sort((s,a)=>{const r=n.closedVacancies[s],d=n.closedVacancies[a];return t?r-d:d-r});i.closedVacancies=l.reduce((s,a)=>(s[a]=n.closedVacancies[a],s),{});break}case"jobsInProgress":{const l=Object.keys(n.jobsInProgress).sort((s,a)=>{const r=n.jobsInProgress[s],d=n.jobsInProgress[a];return t?r-d:d-r});i.jobsInProgress=l.reduce((s,a)=>(s[a]=n.jobsInProgress[a],s),{});break}case"executedJobs":{const l=Object.keys(n.executedJobs).sort((s,a)=>{const r=n.executedJobs[s],d=n.executedJobs[a];return t?r-d:d-r});i.executedJobs=l.reduce((s,a)=>(s[a]=n.executedJobs[a],s),{});break}default:{console.log("Invalid property: "+e);break}}x(i)}},Te=(c,e,t)=>{const i=l=>s=>{c(s,l)};return o.jsx(Fe,{children:o.jsx(A,{children:we.map((l,s)=>o.jsx(f,{align:`${s>0?"center":"left"}`,children:o.jsxs(Ae,{active:t===l.id,direction:t===l.id?e:"asc",onClick:i(l.id),children:[l.label,t===l.id?o.jsx(De,{component:"span",sx:Be,children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},l.id))})})},Le=()=>{let c;if(j!=="")switch(j){case"assignment":c=n.openVacancies;break;case"registrations":c=n.registrations;break;case"openVacancies":c=n.openVacancies;break;case"closedVacancies":c=n.closedVacancies;break;case"jobsInProgress":c=n.jobsInProgress;break;case"executedJobs":c=n.executedJobs;break;default:console.log("Invalid orderBy: "+j);break}else{const e=C.getVacancyCombo().map(t=>({[t.value]:[]}));c=Object.assign({},...e)}return o.jsx(o.Fragment,{children:c&&Object.keys(c).map(e=>{if(e!=="Total")return o.jsxs(A,{hover:!0,role:"checkbox",tabIndex:-1,children:[o.jsx(f,{align:"left",children:e}),o.jsx(f,{align:"center",children:n.registrations[e]}),o.jsx(f,{align:"center",children:n.openVacancies[e]}),o.jsx(f,{align:"center",children:n.closedVacancies[e]}),o.jsx(f,{align:"center",children:n.jobsInProgress[e]}),o.jsx(f,{align:"center",children:n.executedJobs[e]})]},e)})})};return u.useEffect(()=>{V&&ve()},[V,g,h]),u.useEffect(()=>{D.current||be()},[]),o.jsxs(o.Fragment,{children:[o.jsx(Ge,{}),o.jsx("div",{className:"w-full min-h-screen desktop:px-96 laptop:px-44 tablet:px-20 mobile:px-2 mobile:pt-2 mobile:pb-12 bg-secondaryColor",children:o.jsxs("div",{className:"flex justify-start w-full h-full mobile:flex-col mobile:justify-center",children:[o.jsx("div",{className:"w-full mt-2 text-2xl font-bold text-center text-primaryColor",children:"CADASTROS"}),Y?o.jsx("div",{className:"flex items-center justify-center h-screen",children:o.jsx(k,{weight:"bold",className:"w-12 h-12 animate-spin text-tertiaryColor"})}):o.jsxs("div",{className:"flex flex-col justify-center w-full h-full",children:[o.jsxs("div",{className:"flex flex-col justify-start w-full",children:[o.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:o.jsx("span",{className:`${w?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Cidade"})}),o.jsx(_,{placeholder:"Selecione",isSearchable:!1,name:"city",options:V?[{value:"Todas",label:"Todas"},...V]:[{value:"Todas",label:"Todas"}],styles:K.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:ue,value:le,isDisabled:w})]}),o.jsxs("div",{className:"flex flex-col justify-start w-full",children:[o.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:o.jsx("span",{className:`${w?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Período"})}),o.jsx(_,{placeholder:"Selecione",isSearchable:!1,name:"city",options:[{value:"Todos",label:"Todos"},...C.getPeriodCombo()],styles:K.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:me,value:de,isDisabled:w})]}),o.jsx("div",{className:"mt-10 text-lg font-semibold text-primaryColor",children:"Relatório:"}),o.jsx("div",{className:"w-full mt-4",children:w?o.jsx("div",{className:"flex items-center justify-center w-full border-2 rounded-lg h-96 border-primaryColor",children:o.jsx(k,{weight:"bold",className:"w-10 h-10 animate-spin text-primaryColor"})}):o.jsx("div",{className:"w-full border-2 rounded-lg border-primaryColor",children:o.jsx(Re,{component:"div",children:o.jsxs(Oe,{"aria-label":"customized table",children:[Te(Ve,H,j),o.jsx(Ee,{children:Le()}),o.jsx(Je,{sx:{backgroundColor:"#FFCE08",color:"white"},children:o.jsxs(A,{children:[o.jsx(f,{align:"left",children:"Total de cadastros"}),o.jsx(f,{align:"center",children:T&&T.length}),o.jsx(f,{align:"center",children:Object.keys(n.openVacancies).reduce((c,e)=>c+n.openVacancies[e],0)}),o.jsx(f,{align:"center",children:Object.keys(n.closedVacancies).reduce((c,e)=>c+n.closedVacancies[e],0)}),o.jsx(f,{align:"center",children:Object.keys(n.jobsInProgress).reduce((c,e)=>c+n.jobsInProgress[e],0)}),o.jsx(f,{align:"center",children:Object.keys(n.executedJobs).reduce((c,e)=>c+n.executedJobs[e],0)})]})})]})})})}),o.jsx("button",{onClick:ke,className:"flex items-center justify-center w-64 h-16 mx-auto mt-10 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-primaryColor shadow-primaryColor/40 text-primaryColor hover:text-[#222] rounded-xl hover:bg-primaryColor disabled:cursor-not-allowed disabled:bg-primaryColor/80 disabled:text-[#222]/80 disabled:border-primaryColor/20",disabled:$||w,children:$?o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx(k,{weight:"bold",className:"w-8 h-8 mr-3 animate-spin"}),o.jsx("span",{children:"Exportando..."})]}):o.jsx("span",{children:"Exportar para Excel"})}),o.jsx("div",{className:"mt-10 text-lg font-semibold text-primaryColor",children:"Indicadores:"}),o.jsxs("div",{className:"flex flex-wrap items-end justify-around w-full mt-4",children:[o.jsxs("div",{className:"flex flex-col items-center justify-around tablet:w-[45%] mobile:w-[80%] h-36 border-2 rounded-lg px-4 py-6 border-tertiaryColor text-tertiaryColor transition-all duration-300 ease-in-out scale-100 hover:scale-110 hover:border-primaryColor hover:text-primaryColor mt-10",children:[o.jsx("span",{className:"text-lg font-semibold text-center",children:"Cadastros"}),o.jsx("div",{className:"flex justify-center",children:ae?o.jsx(k,{weight:"bold",className:"w-10 h-10 animate-spin"}):o.jsx("span",{className:"text-2xl font-semibold text-center",children:T.length})})]}),o.jsxs("div",{className:"flex flex-col items-center justify-around tablet:w-[45%] mobile:w-[80%] h-36 border-2 rounded-lg px-4 py-6 border-tertiaryColor text-tertiaryColor transition-all duration-300 ease-in-out scale-100 hover:scale-110 hover:border-primaryColor hover:text-primaryColor mt-10",children:[o.jsx("span",{className:"text-lg font-semibold text-center",children:"Contratantes"}),o.jsx("div",{className:"flex justify-center",children:oe?o.jsx(k,{weight:"bold",className:"w-10 h-10 animate-spin"}):o.jsx("span",{className:"text-2xl font-semibold text-center",children:ee.length})})]}),o.jsxs("div",{className:"flex flex-col items-center justify-around tablet:w-[45%] mobile:w-[80%] h-36 border-2 rounded-lg px-4 py-6 border-tertiaryColor text-tertiaryColor transition-all duration-300 ease-in-out scale-100 hover:scale-110 hover:border-primaryColor hover:text-primaryColor mt-10",children:[o.jsx("span",{className:"text-lg font-semibold text-center",children:"Freelancers"}),o.jsx("div",{className:"flex justify-center",children:re?o.jsx(k,{weight:"bold",className:"w-10 h-10 animate-spin"}):o.jsx("span",{className:"text-2xl font-semibold text-center",children:se.length})})]}),o.jsxs("div",{className:"flex flex-col items-center justify-around tablet:w-[45%] mobile:w-[80%] h-36 border-2 rounded-lg px-4 py-6 border-tertiaryColor text-tertiaryColor transition-all duration-300 ease-in-out scale-100 hover:scale-110 hover:border-primaryColor hover:text-primaryColor mt-10",children:[o.jsx("span",{className:"text-lg font-semibold text-center",children:"Acessos"}),o.jsx("div",{className:"flex justify-center",children:ne?o.jsx(k,{weight:"bold",className:"w-10 h-10 animate-spin"}):o.jsx("span",{className:"text-2xl font-semibold text-center",children:te.length})})]})]})]})]})})]})}export{_e as AdminRegistrations};

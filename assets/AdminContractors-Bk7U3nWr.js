import{r as i,E as ae,T as le,F as y,j as e,C as j,J as re,K as ne,M as ie,P as T,O as ce,Q as de,V as me,X as ue,Y as fe,Z as xe}from"./vendor-LjbCKWXj.js";import{M as he}from"./Menu-Be-87iSB.js";import{S as $,a as q,C as B}from"./Select-C8PQA4vz.js";import{u as be,A as z}from"./index-B8ZXL9Jk.js";function je(){const{authToken:h}=be(),v=i.useRef(!1),[w,D]=i.useState(null),[I,U]=i.useState(!0),[b,C]=i.useState(),[f,S]=i.useState("Todas"),[p,N]=i.useState("Todos"),[m,g]=i.useState({}),[u,R]=i.useState(!0),[E,F]=i.useState(!1),[L,W]=i.useState("asc"),[k,H]=i.useState("date"),[M,O]=i.useState({value:"Todas",label:"Todas"}),[Q,A]=i.useState({value:"Todos",label:"Todos"}),G=(o,t)=>{t&&(t.action==="clear"?(O({value:"Todas",label:"Todas"}),S("Todas")):o&&"value"in o&&(O(o),S(o.value)))},J=(o,t)=>{t&&(t.action==="clear"?(A({value:"Todos",label:"Todos"}),N("Todos")):o&&"value"in o&&(A(o),N(o.value)))},K=async()=>{if(v.current=!0,h){const o=await z.request({origin:"Web",method:"GET",url:"/contractors/cities",authToken:h});if(o.success&&o.data){const t=o.data;if(t.length>0){const s=[];t.map(a=>{s.push({value:a,label:a})}),C(s)}else C([])}else C([])}},X=async o=>{if(h){let t=null;switch(p){case"Últimas 24 horas":t=1;break;case"Última semana":t=7;break;case"Último mês":t=30;break;case"Últimos 3 meses":t=90;break;case"Último ano":t=365;break}const s=B.getCompanySegmentCombo().map(r=>r.value),a={};for(const r of s)a[r]=0;const l=await z.request({origin:"Web",method:"GET",url:"/admins/contractors",params:{city:f!=="Todas"?f:void 0,lastDays:t||void 0},authToken:h,signal:o});if(l.success&&l.data){const r=l.data;if(r&&r.length>0)for(const c of r)for(const n of s)c.companySegment===n&&a[n]++;return g({Total:r.length,...a}),!0}else return g({Total:m.length,...a}),!1}return!1},Y=()=>{w&&w.abort("Operation canceled by the user")},Z=async()=>{U(!1),R(!0);let o=0;const t=1;try{Y();const s=new AbortController;D(s),o=(await Promise.all([X(s.signal)])).filter(l=>l).length}catch(s){console.error(s==null?void 0:s.toString())}finally{o===t&&R(!1)}},_=async()=>{F(!0);const o=new xe.Workbook,t=o.addWorksheet("Contratantes");t.addRow(`Cidade: ${f}`),t.getCell("A1").value={richText:[{text:"Cidade: ",font:{bold:!0}},{text:f}]},t.addRow(`Período: ${p}`),t.getCell("A2").value={richText:[{text:"Período: ",font:{bold:!0}},{text:p}]},t.addRow([" "]),t.addRow(["Segmento","Quantidade"]);const s=t.getRow(4);s.eachCell(d=>{d.alignment={horizontal:"left",vertical:"middle"},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},d.font={color:{argb:"FFFFFF"}}}),s.height=30,Object.keys(m).forEach(d=>{d!=="Total"&&t.addRow([d,m[d]])}),t.addRow(["Total",m.Total]);const a=t.getRow(Object.keys(m).length+4);a.eachCell(d=>{d.alignment={horizontal:"left",vertical:"middle"},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},d.font={color:{argb:"FFFFFF"}}}),a.height=20,t.getColumn("A").width=60,t.getColumn("A").alignment={horizontal:"left",vertical:"middle"},t.getColumn("B").width=20,t.getColumn("B").alignment={horizontal:"center",vertical:"middle"};const l=await o.xlsx.writeBuffer(),r=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(r),n=document.createElement("a");n.href=c;const P=new Date,oe=P.toISOString().split("T")[0],se=P.toLocaleTimeString().replace(/:/g,".");n.download=`contratantes${oe}_${se}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(c),F(!1)},V=[{id:"companySegment",numeric:!1,disablePadding:!1,label:"Segmento"},{id:"quantity",numeric:!0,disablePadding:!1,label:"Quantidade"}],x=ae(le)(({theme:o})=>({[`&.${y.head}`]:{backgroundColor:"#FFCE08",color:"#222222",fontWeight:"bold",border:"none"},[`&.${y.body}`]:{fontSize:14,color:o.palette.common.white,borderColor:"#FFCE08"},[`&.${y.footer}`]:{fontSize:14,fontWeight:"bold",border:"none",color:"#222222"}})),ee=(o,t)=>{if(o){const s=k===t&&L==="asc";W(s?"desc":"asc"),H(t);const a={...m},r=Object.keys(a).sort((c,n)=>t==="companySegment"?s?c.localeCompare(n):n.localeCompare(c):t==="quantity"?s?a[c]-a[n]:a[n]-a[c]:0).reduce((c,n)=>(c[n]=a[n],c),{});g(r)}},te=(o,t,s)=>{const a=l=>r=>{o(r,l)};return e.jsx(de,{children:e.jsx(T,{children:V.map((l,r)=>e.jsx(x,{align:`${r>0?"center":"left"}`,children:e.jsxs(me,{active:s===l.id,direction:s===l.id?t:"asc",onClick:a(l.id),children:[l.label,s===l.id?e.jsx(ue,{component:"span",sx:fe,children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},l.id))})})};return i.useEffect(()=>{b&&Z()},[b,f,p]),i.useEffect(()=>{v.current||K()},[]),e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx("div",{className:"w-full min-h-screen desktop:px-96 laptop:px-44 tablet:px-20 mobile:px-2 mobile:pt-2 mobile:pb-12 bg-secondaryColor",children:e.jsxs("div",{className:"flex justify-start w-full h-full mobile:flex-col mobile:justify-center",children:[e.jsx("div",{className:"w-full mt-2 text-2xl font-bold text-center text-primaryColor",children:"CONTRATANTES"}),I?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(j,{weight:"bold",className:"w-12 h-12 animate-spin text-tertiaryColor"})}):e.jsxs("div",{className:"flex flex-col justify-center w-full h-full",children:[e.jsxs("div",{className:"flex flex-col justify-start w-full",children:[e.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:e.jsx("span",{className:`${u?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Cidade"})}),e.jsx($,{placeholder:"Selecione",isSearchable:!1,name:"city",options:b?[{value:"Todas",label:"Todas"},...b]:[{value:"Todas",label:"Todas"}],styles:q.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:G,value:M,isDisabled:u})]}),e.jsxs("div",{className:"flex flex-col justify-start w-full",children:[e.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:e.jsx("span",{className:`${u?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Período"})}),e.jsx($,{placeholder:"Selecione",isSearchable:!1,name:"city",options:[{value:"Todos",label:"Todos"},...B.getPeriodCombo()],styles:q.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:J,value:Q,isDisabled:u})]}),e.jsx("div",{className:"mt-10 text-lg font-semibold text-primaryColor",children:"Relatório:"}),e.jsx("div",{className:"w-full mt-4",children:u?e.jsx("div",{className:"flex items-center justify-center w-full border-2 rounded-lg h-96 border-primaryColor",children:e.jsx(j,{weight:"bold",className:"w-10 h-10 animate-spin text-primaryColor"})}):e.jsx("div",{className:"w-full border-2 rounded-lg border-primaryColor",children:e.jsx(re,{component:"div",children:e.jsxs(ne,{"aria-label":"customized table",children:[te(ee,L,k),e.jsx(ie,{children:Object.keys(m).map(o=>{if(o!=="Total")return e.jsxs(T,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(x,{align:"left",children:o}),e.jsx(x,{align:"center",children:m[o]})]},o)})}),e.jsx(ce,{sx:{backgroundColor:"#FFCE08",color:"white"},children:e.jsxs(T,{children:[e.jsx(x,{align:"left",children:"Total de cadastros"}),e.jsx(x,{align:"center",children:m.Total})]})})]})})})}),e.jsx("button",{onClick:_,className:"flex items-center justify-center w-64 h-16 mx-auto mt-10 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-primaryColor shadow-primaryColor/40 text-primaryColor hover:text-[#222] rounded-xl hover:bg-primaryColor disabled:cursor-not-allowed disabled:bg-primaryColor/80 disabled:text-[#222]/80 disabled:border-primaryColor/20",disabled:u||E,children:E?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(j,{weight:"bold",className:"w-8 h-8 mr-3 animate-spin"}),e.jsx("span",{children:"Exportando..."})]}):e.jsx("span",{children:"Exportar para Excel"})})]})]})})]})}export{je as AdminContractors};

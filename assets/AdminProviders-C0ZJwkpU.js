import{r as n,E as le,T as ae,F as v,j as e,C as y,J as re,K as ie,M as ne,P as j,O as de,Q as ce,V as ue,X as me,Y as fe,Z as xe}from"./vendor-LjbCKWXj.js";import{M as he}from"./Menu-DyNH6XyK.js";import{u as be,A as $}from"./index-DLufcNUo.js";import{S as q,a as B,C as z}from"./Select-C8PQA4vz.js";function ye(){const{authToken:h}=be(),T=n.useRef(!1),[w,D]=n.useState(null),[I,U]=n.useState(!0),[b,g]=n.useState(),[f,S]=n.useState("Todas"),[p,R]=n.useState("Todos"),[u,C]=n.useState({}),[m,E]=n.useState(!0),[F,N]=n.useState(!1),[L,W]=n.useState("asc"),[P,H]=n.useState("date"),[J,k]=n.useState({value:"Todas",label:"Todas"}),[K,O]=n.useState({value:"Todos",label:"Todos"}),M=(s,t)=>{t&&(t.action==="clear"?(k({value:"Todas",label:"Todas"}),S("Todas")):s&&"value"in s&&(k(s),S(s.value)))},Q=(s,t)=>{t&&(t.action==="clear"?(O({value:"Todos",label:"Todos"}),R("Todos")):s&&"value"in s&&(O(s),R(s.value)))},G=async()=>{if(T.current=!0,h){const s=await $.request({origin:"Web",method:"GET",url:"/providers/cities",authToken:h});if(s.success&&s.data){const t=s.data;if(t.length>0){const o=[];t.map(l=>{o.push({value:l,label:l})}),g(o)}else g([])}else g([])}},_=async s=>{if(h){let t=null;switch(p){case"Últimas 24 horas":t=1;break;case"Última semana":t=7;break;case"Último mês":t=30;break;case"Últimos 3 meses":t=90;break;case"Último ano":t=365;break}const o=z.getVacancyCombo().map(r=>r.value),l={};for(const r of o)l[r]=0;const a=await $.request({origin:"Web",method:"GET",url:"/admins/providers",params:{city:f!=="Todas"?f:void 0,lastDays:t||void 0},authToken:h,signal:s});if(a.success&&a.data){const r=a.data;if(r&&r.length>0)for(const d of r)for(const i of o)d.desiredJobVacancy.includes(i)&&l[i]++;return C({Total:r.length,...l}),!0}else return C({Total:u.length,...l}),!1}return!1},X=()=>{w&&w.abort("Operation canceled by the user")},Y=async()=>{U(!1),E(!0);let s=0;const t=1;try{X();const o=new AbortController;D(o),s=(await Promise.all([_(o.signal)])).filter(a=>a).length}catch(o){console.error(o==null?void 0:o.toString())}finally{s===t&&E(!1)}},Z=async()=>{N(!0);const s=new xe.Workbook,t=s.addWorksheet("Freelancers");t.addRow(`Cidade: ${f}`),t.getCell("A1").value={richText:[{text:"Cidade: ",font:{bold:!0}},{text:f}]},t.addRow(`Período: ${p}`),t.getCell("A2").value={richText:[{text:"Período: ",font:{bold:!0}},{text:p}]},t.addRow([" "]),t.addRow(["Cargo","Quantidade"]);const o=t.getRow(4);o.eachCell(c=>{c.alignment={horizontal:"left",vertical:"middle"},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},c.font={color:{argb:"FFFFFF"}}}),o.height=30,Object.keys(u).forEach(c=>{c!=="Total"&&t.addRow([c,u[c]])}),t.addRow(["Total",u.Total]);const l=t.getRow(Object.keys(u).length+4);l.eachCell(c=>{c.alignment={horizontal:"left",vertical:"middle"},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},c.font={color:{argb:"FFFFFF"}}}),l.height=20,t.getColumn("A").width=60,t.getColumn("A").alignment={horizontal:"left",vertical:"middle"},t.getColumn("B").width=20,t.getColumn("B").alignment={horizontal:"center",vertical:"middle"};const a=await s.xlsx.writeBuffer(),r=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(r),i=document.createElement("a");i.href=d;const A=new Date,se=A.toISOString().split("T")[0],oe=A.toLocaleTimeString().replace(/:/g,".");i.download=`freelancers_${se}_${oe}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d),N(!1)},V=[{id:"assignment",numeric:!1,disablePadding:!1,label:"Cargo"},{id:"quantity",numeric:!0,disablePadding:!1,label:"Quantidade"}],x=le(ae)(({theme:s})=>({[`&.${v.head}`]:{backgroundColor:"#FFCE08",color:"#222222",fontWeight:"bold",border:"none"},[`&.${v.body}`]:{fontSize:14,color:s.palette.common.white,borderColor:"#FFCE08"},[`&.${v.footer}`]:{fontSize:14,fontWeight:"bold",border:"none",color:"#222222"}})),ee=(s,t)=>{if(s){const o=P===t&&L==="asc";W(o?"desc":"asc"),H(t);const l={...u},r=Object.keys(l).sort((d,i)=>t==="assignment"?o?d.localeCompare(i):i.localeCompare(d):t==="quantity"?o?l[d]-l[i]:l[i]-l[d]:0).reduce((d,i)=>(d[i]=l[i],d),{});C(r)}},te=(s,t,o)=>{const l=a=>r=>{s(r,a)};return e.jsx(ce,{children:e.jsx(j,{children:V.map((a,r)=>e.jsx(x,{align:`${r>0?"center":"left"}`,children:e.jsxs(ue,{active:o===a.id,direction:o===a.id?t:"asc",onClick:l(a.id),children:[a.label,o===a.id?e.jsx(me,{component:"span",sx:fe,children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},a.id))})})};return n.useEffect(()=>{b&&Y()},[b,f,p]),n.useEffect(()=>{T.current||G()},[]),e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx("div",{className:"w-full min-h-screen desktop:px-96 laptop:px-44 tablet:px-20 mobile:px-2 mobile:pt-2 mobile:pb-12 bg-secondaryColor",children:e.jsxs("div",{className:"flex justify-start w-full h-full mobile:flex-col mobile:justify-center",children:[e.jsx("div",{className:"w-full mt-2 text-2xl font-bold text-center text-primaryColor",children:"FREELANCERS"}),I?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(y,{weight:"bold",className:"w-12 h-12 animate-spin text-tertiaryColor"})}):e.jsxs("div",{className:"flex flex-col justify-center w-full h-full",children:[e.jsxs("div",{className:"flex flex-col justify-start w-full",children:[e.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:e.jsx("span",{className:`${m?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Cidade"})}),e.jsx(q,{placeholder:"Selecione",isSearchable:!1,name:"city",options:b?[{value:"Todas",label:"Todas"},...b]:[{value:"Todas",label:"Todas"}],styles:B.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:M,value:J,isDisabled:m})]}),e.jsxs("div",{className:"flex flex-col justify-start w-full",children:[e.jsx("div",{className:"flex justify-start w-full mt-4 mb-1",children:e.jsx("span",{className:`${m?"text-tertiaryColor/50":"text-tertiaryColor"} text-start`,children:"Período"})}),e.jsx(q,{placeholder:"Selecione",isSearchable:!1,name:"city",options:[{value:"Todos",label:"Todos"},...z.getPeriodCombo()],styles:B.getCustomStyles(),noOptionsMessage:()=>"Nenhum resultado encontrado",onChange:Q,value:K,isDisabled:m})]}),e.jsx("div",{className:"mt-10 text-lg font-semibold text-primaryColor",children:"Relatório:"}),e.jsx("div",{className:"w-full mt-4",children:m?e.jsx("div",{className:"flex items-center justify-center w-full border-2 rounded-lg h-96 border-primaryColor",children:e.jsx(y,{weight:"bold",className:"w-10 h-10 animate-spin text-primaryColor"})}):e.jsx("div",{className:"w-full border-2 rounded-lg border-primaryColor",children:e.jsx(re,{component:"div",children:e.jsxs(ie,{"aria-label":"customized table",children:[te(ee,L,P),e.jsx(ne,{children:Object.keys(u).map(s=>{if(s!=="Total")return e.jsxs(j,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(x,{align:"left",children:s}),e.jsx(x,{align:"center",children:u[s]})]},s)})}),e.jsx(de,{sx:{backgroundColor:"#FFCE08",color:"white"},children:e.jsxs(j,{children:[e.jsx(x,{align:"left",children:"Total de cadastros"}),e.jsx(x,{align:"center",children:u.Total})]})})]})})})}),e.jsx("button",{onClick:Z,className:"flex items-center justify-center w-64 h-16 mx-auto mt-10 font-bold transition-all duration-500 ease-in-out border-4 shadow-lg mobile:text-base border-primaryColor shadow-primaryColor/40 text-primaryColor hover:text-[#222] rounded-xl hover:bg-primaryColor disabled:cursor-not-allowed disabled:bg-primaryColor/80 disabled:text-[#222]/80 disabled:border-primaryColor/20",disabled:m||F,children:F?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(y,{weight:"bold",className:"w-8 h-8 mr-3 animate-spin"}),e.jsx("span",{children:"Exportando..."})]}):e.jsx("span",{children:"Exportar para Excel"})})]})]})})]})}export{ye as AdminProviders};

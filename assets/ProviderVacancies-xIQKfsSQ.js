import{r as o,j as e,C,aG as B,X as D,a5 as s,a6 as L}from"./vendor-LjbCKWXj.js";import{u as $,A as S,b as W}from"./index-B8ZXL9Jk.js";import{M as q}from"./Menu-DfszxzCa.js";import{V as K}from"./Vacancy-CN_7261N.js";import{G as U}from"./geolocationService-Br-_cx1P.js";import"./monetaryUtil-Ccsb3nQ9.js";import"./useConfirmation-DtzCcLFP.js";import"./images-Bf77nNy9.js";import"./Loading-Cd5r56ie.js";import"./successAnimation-C1ByJTMN.js";function re(){const{authToken:l}=$(),b=o.useRef(!1),v=o.useRef(!1),[r,k]=o.useState(null),[f,d]=o.useState([]),[A,x]=o.useState(!0),[h,E]=o.useState(1),[j,y]=o.useState(!0),[I,R]=o.useState(!1),[c,V]=o.useState(null),P=async()=>{if(b.current=!0,l){const a=await W.getProviderByUser(l);k(a)}},w=async a=>{if(v.current=!0,x(!0),l&&r){const t=await S.request({origin:"Web",method:"GET",url:`/providers/${r.id}/filtered-vacancies?page=${a}&limit=5`,authToken:l});if(t.success&&t.data){const n=t.data;d(i=>{const m=[...i];return n.forEach(u=>{m.some(g=>g.id===u.id)||m.push(u)}),m}),y(n.length>0)}else d([]),y(!1),x(!1)}x(!1)},M=()=>{j&&(E(a=>a+1),w(h+1))},G=()=>{const a=L("https://freela-servicos.duckdns.org");V(a),a.on("contractorCreatedVacancy",async t=>{if(r.desiredJobVacancy.includes(t.assignment)&&r.latitude!==0&&r.longitude!==0&&l){const n={latitude:r.latitude,longitude:r.longitude},i=await S.request({origin:"Web",method:"GET",url:`/contractors/${t.contractorId}`,authToken:l});if(i.success&&i.data){const m=i.data,u={latitude:m.latitude,longitude:m.longitude};if(u.latitude!==0&&u.longitude!==0){const N=await U.getCoordinatesDistanceInKilometers(n,u),g=r.mileageRadius;N<=g&&d(p=>p.some(T=>T.id===t.id)?p:[t,...p])}}}}),a.on("contractorDeletedVacancy",t=>{d(n=>n.filter(i=>i.id!==t))}),a.on("contractorAcceptedCandidacy",t=>{r.id===t.providerId&&d(n=>n.filter(i=>i.id!==t.vacancyId))}),a.on("contractorRejectedCandidacy",t=>{r.id===t.providerId&&d(n=>n.filter(i=>i.id!==t.vacancyId))})};return o.useEffect(()=>{if(!v.current&&r)return w(h),G(),()=>{c&&c.connected&&(c.off("contractorCreatedVacancy"),c.off("contractorDeletedVacancy"),c.off("contractorAcceptedCandidacy"),c.off("contractorRejectedCandidacy"),c.disconnect())}},[r]),o.useEffect(()=>{b.current||P()},[]),e.jsxs(e.Fragment,{children:[r?e.jsx("div",{className:"flex items-start justify-center w-full min-h-screen bg-secondaryColor desktop:px-96 laptop:px-44 tablet:px-20 mobile:px-2 tablet:pb-32 mobile:pb-28",children:e.jsx("div",{className:"flex flex-row w-full h-full mobile:flex-col mobile:justify-start",children:e.jsxs("div",{className:"mt-1 w-full min-h-[80vh]",children:[e.jsx("span",{className:"text-lg font-semibold underline text-tertiaryColor underline-offset-8",children:"Vagas disponÃ­veis"}),A&&h===1?e.jsx("div",{className:"w-full min-h-[80vh] flex justify-center items-center",children:e.jsx(C,{weight:"bold",className:"w-14 h-14 animate-spin text-tertiaryColor"})}):e.jsx(B,{dataLength:f.length,next:M,hasMore:j,loader:e.jsx("div",{className:"flex items-center justify-center w-full h-24",children:e.jsx(C,{weight:"bold",className:"w-8 h-8 animate-spin text-tertiaryColor"})}),endMessage:e.jsx("p",{className:"text-center",children:"Nenhuma vaga encontrada"}),children:f.length===0?e.jsx("div",{className:"flex items-center justify-center w-full h-full mt-10 text-center text-tertiaryColor",children:"Nenhuma vaga encontrada"}):f.map((a,t)=>e.jsx(K,{vacancy:a,provider:r,profileType:"provider",disabledApplyCandidacyButton:I,setDisabledApplyCandidacyButton:R},t))})]})})}):e.jsx("div",{className:"w-full h-screen desktop:px-80 laptop:px-36 tablet:px-24 mobile:px-2 mobile:pt-2 mobile:pb-32 bg-secondaryColor",children:e.jsxs(D,{children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"1rem",className:"mx-auto mt-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"8.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"16rem",className:"rounded-md"}),e.jsxs("div",{className:"flex justify-start w-full h-24 laptop:flex-row mobile:flex-col",children:[e.jsxs("div",{className:"flex flex-row desktop:w-[50%] laptop:w-[60%] tablet:w-[60%] mobile:w-full laptop:justify-start mobile:justify-between",children:[e.jsxs("div",{className:"flex flex-col w-[17rem]",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]}),e.jsx("div",{className:"flex items-end justify-center w-10 h-full",children:e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"55%",height:"0.2rem",className:"mb-6 rounded-md"})}),e.jsxs("div",{className:"flex flex-col w-[7.5rem]",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]})]}),e.jsxs("div",{className:"flex flex-col w-full laptop:ml-10",children:[e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"7.5rem",height:"0.6rem",className:"mt-[1.75rem] mb-2 rounded-md"}),e.jsx(s,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:"3rem",className:"rounded-md"})]})]})]})}),e.jsx(q,{profileType:"provider",pageSelected:"findVacancies"})]})}export{re as ProviderVacancies};
